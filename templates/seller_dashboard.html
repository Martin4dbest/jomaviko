<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seller Dashboard - JOMAVIKO CO. LTD</title>

  <!-- Tailwind & AlpineJS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col font-sans">

  <!-- Header -->
  <header class="bg-gray-800 text-white shadow-md p-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <!-- Company Name and Dashboard Title -->
      <h1 class="text-2xl font-bold tracking-wide flex flex-wrap items-center">
        <span class="mr-2">ðŸ“¦ JOMAVIKO</span>
        <span class="hidden sm:inline">CO. LTD</span>
      </h1>
      <h1 class="text-2xl font-bold tracking-wide">Seller Dashboard</h1>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-grow flex" x-data="{ sidebarOpen: true }">

    <!-- Sidebar -->
    <aside
      class="transition-all duration-300 ease-in-out bg-gray-200 text-gray-800 shadow-md"
      :class="sidebarOpen ? 'w-64 p-4' : 'w-16 p-2'"
    >
      <!-- Toggle Button -->
      <div class="flex justify-end mb-4">
        <button
          @click="sidebarOpen = !sidebarOpen"
          class="focus:outline-none text-black hover:text-teal-400"
          title="Toggle Sidebar"
        >
          <svg x-show="!sidebarOpen" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg x-show="sidebarOpen" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M6 18L18 12L6 6V18Z" />
          </svg>
        </button>
      </div>

      <!-- Seller Info -->
      <div x-show="sidebarOpen" class="transition-all duration-300 ease-in-out">
        <h2 class="text-lg font-semibold mb-3 border-b pb-1">ðŸ‘¤ Seller Info</h2>
        <p class="mb-1"><strong>Name:</strong> {{ seller_details.name }}</p>
        <p class="mb-1"><strong>Location:</strong> {{ seller_details.location }}</p>
        <p><strong>Role:</strong> {{ seller_details.role }}</p>

        <!-- Logout Button -->
        <a href="{{ url_for('logout') }}" class="mt-4 text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded shadow">Logout</a>
      </div>
    </aside>

    <!-- Main Section -->
    <section class="flex-grow bg-white p-6 mx-4 my-6 rounded-lg shadow-lg">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800">ðŸ“‹ Product List</h2>

      <!-- Alert Box -->
      <div id="alertBox" class="alert alert-success text-green-700 bg-green-100 border border-green-300 px-4 py-2 rounded my-4" role="alert" style="display: none;">
        Order sent to admin successfully.
      </div>

      <!-- Search Field -->
      <div class="mb-4">
        <input
          type="text"
          placeholder="Search Product..."
          class="w-64 p-2 border border-gray-300 rounded text-sm focus:outline-none"
          id="search-input"
        />
      </div>

      {% if products|length > 0 %}
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white table-auto border-collapse shadow-md rounded-md">
          <thead>
            <tr class="bg-gray-800 text-white text-left text-sm">
              <th class="px-6 py-3">Product</th>
              <th class="px-6 py-3">ID Number</th>
              <th class="px-6 py-3">Retail Price ($)</th>
              <th class="px-6 py-3">Sold Price ($)</th>
              <th class="px-6 py-3">Qty In Stock</th>
              <th class="px-6 py-3">Quantity Sold</th>
              <th class="px-6 py-3">Total Amount Sold ($)</th>
              <th class="px-6 py-3">Date & Time</th>
              <th class="px-6 py-3">Action</th>
            </tr>
          </thead>
          <tbody class="text-sm" id="product-list">
            {% for product in products %}
            <tr class="border-b hover:bg-gray-50">
              <td class="px-6 py-3 font-medium">{{ product.name }}</td>
              <td class="px-6 py-3 text-gray-500">{{ product.identification_number }}</td>
              <td class="px-6 py-3">${{ "%.2f"|format(product.price) }}</td>

              <!-- Editable Selling Price -->
              <td class="px-6 py-3">
                <input
                  type="number"
                  step="0.01"
                  id="selling-price-{{ product.id }}"
                  class="w-20 p-1 border border-gray-300 rounded text-sm focus:outline-none"
                  value="{{ product.selling_price or '' }}"
                  @input="calculateAmountSold({{ product.id }})"
                />
              </td>

              <!-- Seller View: In Stock -->
              <td class="px-6 py-3">
                <input
                  type="text"
                  id="instock-{{ product.id }}"
                  value="{{ product.in_stock if product.in_stock is not none else '' }}"
                  class="w-20 p-1 border border-gray-300 rounded-md text-sm bg-gray-50 focus:outline-none"
                  readonly
                />
              </td>

              <!-- Input: Order Quantity -->
              <td class="px-6 py-3">
                <input
                  type="number"
                  id="order-qty-{{ product.id }}"
                  class="w-20 p-1 border border-gray-300 rounded text-sm focus:outline-none"
                  @input="calculateAmountSold({{ product.id }})"
                />
              </td>

              <!-- Amount Sold -->
              <td class="px-6 py-3">
                <input
                  type="text"
                  id="amount-sold-{{ product.id }}"
                  class="w-24 p-1 border border-gray-300 rounded text-sm bg-gray-50 focus:outline-none"
                  readonly
                />
              </td>

              <!-- Date & Time -->
              <td class="px-6 py-3">
                <input
                  type="text"
                  id="date-sold-{{ product.id }}"
                  class="w-32 p-1 border border-gray-300 rounded text-sm bg-gray-50 focus:outline-none"
                  readonly
                />
              </td>

              <!-- Action -->
              <td class="px-6 py-3">
                <button
                  @click="sendOrder({{ product.id }})"
                  class="bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded shadow text-sm"
                >
                  Send
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="py-4 text-center text-red-500">No products found</div>
      {% endif %}
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-4 text-center text-sm mt-auto">
    &copy; 2025 JOMAVIKO CO. LTD. All rights reserved.
  </footer>

  <script>
    // Filter products based on the search input
    document.getElementById("search-input").addEventListener("input", function() {
      const searchQuery = this.value.toLowerCase();
      const rows = document.querySelectorAll('.product-row');
  
      rows.forEach(row => {
        const productName = row.querySelector('td').textContent.toLowerCase();
        row.style.display = productName.includes(searchQuery) ? '' : 'none';
      });
    });
  
    function calculateAmountSold(productId) {
      const qtyInput = document.getElementById(`order-qty-${productId}`);
      const sellingPriceInput = document.getElementById(`selling-price-${productId}`);
      const amountSoldInput = document.getElementById(`amount-sold-${productId}`);
      const inStockInput = document.getElementById(`instock-${productId}`);
  
      if (!qtyInput || !sellingPriceInput || !amountSoldInput || !inStockInput) return;
  
      const qty = parseFloat(qtyInput.value) || 0;
      const sellingPrice = parseFloat(sellingPriceInput.value) || 0;
      const inStock = parseFloat(inStockInput.value) || 0;
  
      if (qty <= inStock) {
        const totalAmount = qty * sellingPrice;
        amountSoldInput.value = totalAmount.toFixed(2);
        // Add the date and time
        const dateSoldInput = document.getElementById(`date-sold-${productId}`);
        dateSoldInput.value = new Date().toLocaleString();
      } else {
        amountSoldInput.value = 'Quantity exceeds stock';
      }
    }
  
    function sendOrder(productId) {
      const qtyInput = document.getElementById(`order-qty-${productId}`);
      const amountSoldInput = document.getElementById(`amount-sold-${productId}`);
  
      if (parseFloat(qtyInput.value) <= 0 || amountSoldInput.value === 'Quantity exceeds stock') {
        alert('Please enter a valid quantity!');
        return;
      }
  
      // Simulate sending the order to the backend
      alert('Order sent to admin successfully!');
  
      // Show success message
      const alertBox = document.getElementById("alertBox");
      alertBox.style.display = 'block';
  
      // Hide the alert after 5 seconds
      setTimeout(() => {
        alertBox.style.display = 'none';
      }, 5000);
  
      // Optionally, reset form or refresh page
      qtyInput.value = '';
      amountSoldInput.value = '';
    }
  </script>
</body>
</html>
