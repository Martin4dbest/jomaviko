<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard — SmartStock</title>

  <!-- Tailwind config (darkMode: 'class') -->
  <script>
    window.tailwind = { config: { darkMode: 'class' } }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <!-- Dashboard component factory (defined before Alpine initializes) -->
  <script>
    function dashboard() {
      return {
        // UI state
        darkMode: false,
        sidebarOpen: window.innerWidth >= 768, // default open on md+
        now: '',
        searchQuery: '',
        rowsPerPage: 20,
        currentPage: 1,
        totalPages: 1,
        pageSummary: '',
        sortIndex: null,
        sortAsc: true,

        init() {
          // load stored theme or system preference
          const stored = localStorage.getItem('jmk_theme');
          this.darkMode = stored ? stored === 'dark' : window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          this.applyTheme();

          // set reasonable rows per page for small devices
          if (window.innerWidth < 640) this.rowsPerPage = 10;

          // start ticking time (local browser time)
          this.tick();
          setInterval(() => this.tick(), 1000);

          // Ensure items are marked visible by default and pagination rendered
          Array.from(this.getItems()).forEach(it => it.dataset.visible = '1');
          this.updatePagination(true);

          // re-calc on resize (responsive behavior)
          window.addEventListener('resize', () => {
            // automatically open sidebar on larger widths
            if (window.innerWidth >= 768) this.sidebarOpen = true;
            this.updatePagination();
          });

          // accessibility: close sidebar with Escape on small screens
          window.addEventListener('keyup', (e) => {
            if (e.key === 'Escape' && window.innerWidth < 768) this.sidebarOpen = false;
          });
        },

        applyTheme() {
          if (this.darkMode) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
          localStorage.setItem('jmk_theme', this.darkMode ? 'dark' : 'light');
        },

        toggleTheme() {
          this.darkMode = !this.darkMode;
          this.applyTheme();
        },

        tick() {
          const d = new Date();
          // show locale-aware date/time; client timezone
          this.now = d.toLocaleDateString() + ' ' + d.toLocaleTimeString();
        },

        /* DOM helpers */
        getItems() {
          return document.querySelectorAll('.product-item'); // both table rows and mobile cards
        },

        /* Filtering */
        filterProducts() {
          const q = (this.searchQuery || '').trim().toLowerCase();
          const items = Array.from(this.getItems());
          items.forEach(it => {
            const name = (it.dataset.name || '').toLowerCase();
            const loc  = (it.dataset.location || '').toLowerCase();
            const visible = !q || name.includes(q) || loc.includes(q);
            it.dataset.visible = visible ? '1' : '0';
          });
          // reset to first page after filtering
          this.updatePagination(true);
        },

        resetFilters() {
          this.searchQuery = '';
          Array.from(this.getItems()).forEach(it => it.dataset.visible = '1');
          this.sortIndex = null;
          this.sortAsc = true;
          this.updatePagination(true);
        },

        /* Sorting (table-only) */
        sortBy(index) {
          // index 0:name, 1:id number, 2:location, 3:price
          const tbody = document.getElementById('product-table-body');
          if (!tbody) return;
          const rows = Array.from(tbody.querySelectorAll('.product-row')); // only table rows
          if (this.sortIndex === index) this.sortAsc = !this.sortAsc;
          else { this.sortIndex = index; this.sortAsc = true; }

          const getKey = (row) => {
            switch (index) {
              case 0: return (row.dataset.name || '').toLowerCase();
              case 1: return (row.dataset.id || '').toLowerCase();
              case 2: return (row.dataset.location || '').toLowerCase();
              case 3: return parseFloat(row.dataset.price || '0') || 0;
              default: return '';
            }
          };

          rows.sort((a, b) => {
            const av = getKey(a), bv = getKey(b);
            if (typeof av === 'number' && typeof bv === 'number') return this.sortAsc ? av - bv : bv - av;
            return this.sortAsc ? String(av).localeCompare(String(bv)) : String(bv).localeCompare(String(av));
          });

          // Reattach in sorted order
          rows.forEach(r => tbody.appendChild(r));
          // Reset pagination (stay on page 1 for clarity)
          this.updatePagination(true);
        },

        sortHint(i) {
          if (this.sortIndex !== i) return '';
          return this.sortAsc ? '▲' : '▼';
        },

        /* Pagination */
        visibleItems() {
          return Array.from(this.getItems()).filter(it => it.dataset.visible !== '0');
        },

        updatePagination(resetPage = false) {
          const items = Array.from(this.getItems());
          const visible = this.visibleItems();
          this.totalPages = Math.max(1, Math.ceil(visible.length / this.rowsPerPage));
          if (resetPage) this.currentPage = 1;
          if (this.currentPage > this.totalPages) this.currentPage = this.totalPages;

          const start = (this.currentPage - 1) * this.rowsPerPage;
          const end = start + this.rowsPerPage;

          // hide all
          items.forEach(it => it.style.display = 'none');

          // show relevant slice
          visible.forEach((it, idx) => {
            if (idx >= start && idx < end) {
              // keep original display behavior for table rows vs cards
              if (it.classList.contains('product-row')) it.style.display = ''; // table rows are shown in tbody
              else it.style.display = ''; // cards shown
            }
          });

          // Update page summary
          const total = visible.length;
          const from = total ? start + 1 : 0;
          const to = Math.min(total, end);
          this.pageSummary = `${from}-${to} of ${total} items`;

          // Reapply low-stock highlight after pagination filter
          this.highlightLowStock();
          // Rebuild pagination UI (DOM)
          this.renderPaginationUI();
        },

        renderPaginationUI() {
          const container = document.getElementById('pagination-container');
          if (!container) return;
          container.innerHTML = '';

          const createBtn = (label, page, disabled = false, active = false) => {
            const btn = document.createElement('button');
            btn.textContent = label;
            btn.className = `px-3 py-1.5 rounded-xl border text-sm ${active ? 'bg-gray-800 text-white border-gray-800' : 'bg-white dark:bg-gray-900 border-gray-300 dark:border-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800'}`;
            btn.disabled = disabled;
            if (!disabled) btn.addEventListener('click', () => { this.currentPage = page; this.updatePagination(); });
            return btn;
          };

          container.appendChild(createBtn('Prev', Math.max(1, this.currentPage - 1), this.currentPage === 1));

          const win = 2;
          const pages = [];
          for (let i = 1; i <= this.totalPages; i++) {
            if (i === 1 || i === this.totalPages || (i >= this.currentPage - win && i <= this.currentPage + win)) pages.push(i);
          }
          let last = 0;
          pages.forEach(p => {
            if (p - last > 1) {
              const ell = document.createElement('span');
              ell.textContent = '…';
              ell.className = 'px-1 text-gray-400';
              container.appendChild(ell);
            }
            container.appendChild(createBtn(String(p), p, false, p === this.currentPage));
            last = p;
          });

          container.appendChild(createBtn('Next', Math.min(this.totalPages, this.currentPage + 1), this.currentPage === this.totalPages));
        },

        changeRowsPerPage() {
          // called when rows-per-page select changes
          this.currentPage = 1;
          this.updatePagination(true);
        },

        /* Low stock highlighting (works for both table and cards) */
        highlightLowStock() {
          Array.from(this.getItems()).forEach(it => {
            const inStock = parseInt(it.dataset.instock || '0', 10);
            // find the visible input element if table row
            const input = it.querySelector("input[id^='instock-']");
            if (!isNaN(inStock) && inStock <= 3) {
              if (input) {
                input.classList.add('text-red-600', 'font-semibold', 'bg-red-50');
                input.title = 'Low stock';
              } else {
                it.classList.add('ring-1', 'ring-red-200', 'bg-red-50/30');
              }
            } else {
              if (input) {
                input.classList.remove('text-red-600', 'font-semibold', 'bg-red-50');
                input.title = '';
              } else {
                it.classList.remove('ring-1', 'ring-red-200', 'bg-red-50/30');
              }
            }
          });
        }
      };
    }
  </script>

  <!-- Alpine (deferred) -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <style>
    html, body { height: 100%; }
    body { font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    /* Mobile card small nicety */
    .product-card .meta { font-size: 0.85rem; color: #6b7280; } /* text-gray-500 */
    @media (max-width: 640px) {
      .table-mobile-hide { display: none; }
    }
  </style>
</head>

<body x-data="dashboard()" x-init="init()" class="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 text-gray-800 dark:from-gray-950 dark:to-gray-900 dark:text-gray-100">

  <div class="flex min-h-screen">

    <!-- Sidebar -->
    <aside
      aria-label="Sidebar"
      :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full sm:translate-x-0'"
      class="fixed sm:static z-40 h-full sm:h-auto sm:min-h-screen w-72 sm:w-72 lg:w-72 transform transition-transform duration-300 bg-gray-900 text-white shadow-xl"
      x-cloak
      >
      <div class="flex items-center justify-between p-4 border-b border-gray-800">
        <div class="flex items-center gap-3">
          <div class="h-8 w-8 rounded-xl bg-amber-500/20 grid place-items-center ring-1 ring-amber-400/30">
            <svg class="w-5 h-5 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 7h18M3 12h18M3 17h18"/>
            </svg>
          </div>
          <div class="leading-tight">
            <div class="text-xs text-gray-400">Admin</div>
            <div class="font-semibold tracking-wide"><span class="text-amber-400">Admin</span> – {{ admin_name }}</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button @click="toggleTheme()" :title="darkMode ? 'Switch to Light' : 'Switch to Dark'" class="p-2 rounded-lg hover:bg-gray-800/60 focus:outline-none">
            <template x-if="!darkMode">
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728 0-.707.707M6.343 17.657l-.707.707M12 8a4 4 0 100 8 4 4 0 000-8z"/>
              </svg>
            </template>
            <template x-if="darkMode">
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
              </svg>
            </template>
          </button>

          <button @click="sidebarOpen = !sidebarOpen" class="p-2 rounded-lg hover:bg-gray-800/60 focus:outline-none sm:hidden" aria-label="Toggle sidebar">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
          </button>
        </div>
      </div>

      <nav class="px-3 py-4 space-y-1 text-sm">
        <a href="{{ url_for('select_order_location') }}" class="group flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-gray-800">
          <svg class="w-5 h-5 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 8h14l1 12H4L5 8zm5 0V6a2 2 0 114 0v2"/>
          </svg>
          <span class="truncate">Shop Orders</span>
        </a>

        <a href="{{ url_for('view_baker_inventory') }}" class="group flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-gray-800">
          <span class="w-5 h-5 grid place-items-center">📋</span>
          <span class="truncate">View Baker Inventory</span>
        </a>

        <a href="{{ url_for('register') }}" class="group flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-gray-800">
          <svg class="w-5 h-5 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M18 9a3 3 0 11-6 0 3 3 0 016 0zM13 16h-1a4 4 0 00-4 4v1h14v-1a4 4 0 00-4-4h-1m-6-4h6"/>
          </svg>
          <span class="truncate">Register</span>
        </a>

        <a href="{{ url_for('view_users') }}" class="group flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-gray-800">
          <svg class="w-5 h-5 text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87m8 0a4 4 0 10-8 0m8 0a4 4 0 018 0m-8-6a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
          <span class="truncate">Sellers & Admins</span>
        </a>

        <form action="{{ url_for('delete_all_products') }}" method="POST" class="px-3" onsubmit="return confirm('Are you sure you want to delete ALL products? This action cannot be undone.')">
          <button type="submit" class="w-full mt-2 flex items-center gap-3 text-left text-red-400 hover:text-white hover:bg-red-600/80 rounded-xl px-3 py-2">
            <span class="inline-flex h-5 w-5 items-center justify-center">🗑️</span>
            <span>Delete All Products</span>
          </button>
        </form>

        <a href="{{ url_for('index') }}" class="group flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-gray-800 mt-2">
          <svg class="w-5 h-5 text-rose-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a4 4 0 01-4 4H7"/></svg>
          <span class="truncate">Logout</span>
        </a>
      </nav>

      <div class="mt-auto p-4 text-xs text-gray-400 border-t border-gray-800">
        <div>&copy; 2025 SmartStock — Inventory Management System</div>
        <div class="mt-1" x-text="now"></div>
      </div>
    </aside>

    <!-- Main content -->
    <main class="flex-1 min-w-0 ml-0 sm:ml-72">
      <!-- Topbar -->
      <div class="sticky top-0 z-30 bg-white/80 dark:bg-gray-900/80 backdrop-blur border-b border-gray-200 dark:border-gray-800">
        <div class="flex items-center justify-between px-4 py-3">
          <h1 class="font-extrabold text-lg"><span class="text-amber-600 dark:text-amber-400">Admin</span> Central – SmartStock</h1>
          <div class="flex items-center gap-3">
            <form method="POST" class="hidden sm:flex items-center gap-2">
              <label for="location" class="sr-only">Select Shop Location</label>
              <select name="location" id="location" required
                class="h-10 rounded-xl border-gray-300 dark:border-gray-700 dark:bg-gray-800/60 px-3">
                <option value="Ikota">Ikota Complex</option>
                <option value="Ajah">Ajah</option>
                <option value="Badore">Badore</option>
              </select>
              <button id="import-button" type="submit" name="import_button" value="1"
                class="h-10 inline-flex items-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-4 shadow">
                Import Products
              </button>
            </form>
            <button onclick="window.open('https://docs.google.com/spreadsheets/d/1IGwC6Ztxcc0BJ1a0qPkXnTQjccSFNqOIaTu1IgwAt6M/edit?gid=1250818856', '_blank')" class="h-10 inline-flex items-center gap-2 rounded-xl bg-blue-600 hover:bg-blue-700 text-white px-4 shadow">
              Open Google Sheet
            </button>
          </div>
        </div>
      </div>

      <!-- Flash -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div id="flash-messages" class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-[92vw] max-w-xl space-y-2">
            {% for category, message in messages %}
              <div class="px-4 py-3 rounded-xl shadow-lg text-sm font-semibold text-white
                          {% if category == 'success' %} bg-emerald-600
                          {% elif category == 'danger' %} bg-red-600
                          {% else %} bg-gray-700 {% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
          <script>
            setTimeout(() => {
              const flash = document.getElementById('flash-messages');
              if (flash) { flash.style.transition = "opacity 0.5s ease"; flash.style.opacity = "0"; setTimeout(()=>flash.remove(), 500); }
            }, 3000);
          </script>
        {% endif %}
      {% endwith %}

      <!-- Header -->
      <header class="px-6 lg:px-8 pt-6">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
          <div>
            <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight">
              <span class="text-amber-600 dark:text-amber-400">Admin Central</span> Management Dashboard
            </h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
              Monitor inventory, manage users, and track performance.
              <span class="ml-2 text-xs text-gray-600 dark:text-gray-300" x-text="now"></span>
            </p>
          </div>

          <div class="flex items-center gap-3">
            <div class="relative w-64">
              <input id="search-input" x-model.debounce.250ms="searchQuery" @input="filterProducts" type="text" placeholder="Search product or location..." class="w-full h-11 rounded-2xl border border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-gray-900/60 px-4 pr-10 focus:ring-2 focus:ring-amber-500" />
              <svg class="absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z"/></svg>
            </div>

            <label class="text-xs text-gray-500 hidden sm:inline">Rows</label>
            <select id="rows-per-page" x-model.number="rowsPerPage" @change="changeRowsPerPage" class="h-11 rounded-xl border-gray-300 dark:border-gray-700 dark:bg-gray-900/60 px-3">
              <option value="10">10</option>
              <option value="20" selected>20</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>

            <button @click="resetFilters" class="h-11 rounded-xl border border-gray-300 dark:border-gray-700 px-4 hover:bg-gray-50 dark:hover:bg-gray-800">Reset</button>
          </div>
        </div>
      </header>

      <!-- KPI Cards -->
      <section class="px-6 lg:px-8 mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="rounded-2xl bg-white dark:bg-gray-900 border p-4">
          <div class="text-xs text-gray-500">Total Products</div>
          <div class="mt-2 flex items-end justify-between">
            <div class="text-2xl font-bold">{{ products|length }}</div>
            <div class="text-xs text-emerald-600">Live</div>
          </div>
        </div>

        <div class="rounded-2xl bg-white dark:bg-gray-900 border p-4">
          <div class="text-xs text-gray-500">Low Stock (≤ 3)</div>
          <div class="mt-2 text-2xl font-bold" x-text="(Array.from(document.querySelectorAll('.product-item')).filter(i => (parseInt(i.dataset.instock||'0')<=3)).length)"></div>
        </div>

        <div class="rounded-2xl bg-white dark:bg-gray-900 border p-4">
          <div class="text-xs text-gray-500">Locations</div>
          <div class="mt-2 text-2xl font-bold" x-text="(function(){ const s = new Set(); document.querySelectorAll('.product-item').forEach(i=> s.add((i.dataset.location||'').trim())); return Array.from(s).filter(Boolean).length; })()"></div>
        </div>

        <div class="rounded-2xl bg-white dark:bg-gray-900 border p-4">
          <div class="text-xs text-gray-500">Last Updated</div>
          <div class="mt-2 text-2xl font-bold" x-text="now"></div>
        </div>
      </section>

      <!-- Table (desktop) -->
      <section class="px-6 lg:px-8 mt-6">
        <div class="overflow-hidden rounded-2xl border bg-white dark:bg-gray-900">
          <div class="overflow-x-auto table-mobile-hide">
            <table class="min-w-full text-sm">
              <thead class="bg-gray-800 text-white sticky top-0 z-10">
                <tr>
                  <th class="px-6 py-3 text-left cursor-pointer" @click="sortBy(0)">Product <span x-text="sortHint(0)"></span></th>
                  <th class="px-6 py-3 text-left cursor-pointer" @click="sortBy(1)">ID Number <span x-text="sortHint(1)"></span></th>
                  <th class="px-6 py-3 text-left cursor-pointer" @click="sortBy(2)">Location <span x-text="sortHint(2)"></span></th>
                  <th class="px-6 py-3 text-left cursor-pointer" @click="sortBy(3)">Retail Price (₦) <span x-text="sortHint(3)"></span></th>
                  <th class="px-6 py-3 text-left">Quantity In Stock</th>
                  <th class="px-6 py-3 text-left">Actions</th>
                </tr>
              </thead>

              <tbody id="product-table-body">
                {% for product in products %}
                <tr
                  class="product-row product-item border-b hover:bg-gray-50 dark:hover:bg-gray-800 transition"
                  data-name="{{ product.name | lower | e }}"
                  data-location="{{ product.location | lower | e }}"
                  data-price="{{ '%.2f'|format(product.price) }}"
                  data-id="{{ product.identification_number | e }}"
                  data-instock="{{ product.in_stock }}"
                >
                  <td class="px-6 py-3 font-medium text-gray-800 dark:text-gray-100">{{ product.name }}</td>
                  <td class="px-6 py-3 text-gray-600 dark:text-gray-300">{{ product.identification_number }}</td>
                  <td class="px-6 py-3">{{ product.location }}</td>
                  <td class="px-6 py-3 text-gray-600 dark:text-gray-300">₦{{ "%.2f"|format(product.price) }}</td>
                  <td class="px-6 py-3">
                    <input type="text" id="instock-{{ product.id }}" value="{{ product.in_stock }}" class="w-24 p-2 text-center rounded-xl border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/60" readonly />
                  </td>
                  <td class="px-6 py-3">
                    <form action="{{ url_for('delete_product', product_id=product.id) }}" method="POST" onsubmit="return confirm('Delete this product?');" class="inline-block">
                      <button type="submit" class="inline-flex items-center gap-1 rounded-xl bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 text-xs shadow">Delete</button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Mobile cards (shown on small screens) -->
          <div id="product-cards" class="md:hidden grid grid-cols-1 gap-3 p-4">
            {% for product in products %}
            <article class="product-card product-item rounded-xl border p-4 bg-white dark:bg-gray-900"
                     data-name="{{ product.name | lower | e }}"
                     data-location="{{ product.location | lower | e }}"
                     data-price="{{ '%.2f'|format(product.price) }}"
                     data-id="{{ product.identification_number | e }}"
                     data-instock="{{ product.in_stock }}">
              <div class="flex items-start justify-between gap-3">
                <div class="flex-1">
                  <div class="flex items-center justify-between">
                    <h3 class="font-semibold">{{ product.name }}</h3>
                    <div class="text-xs text-gray-500">₦{{ "%.2f"|format(product.price) }}</div>
                  </div>
                  <div class="text-xs meta mt-2">{{ product.location }} · ID: {{ product.identification_number }}</div>
                </div>
              </div>

              <div class="mt-3 flex items-center justify-between">
                <div class="text-sm text-gray-600">In stock: <span class="font-mono">{{ product.in_stock }}</span></div>
                <form action="{{ url_for('delete_product', product_id=product.id) }}" method="POST" onsubmit="return confirm('Delete this product?');">
                  <button type="submit" class="inline-flex items-center gap-1 rounded-xl bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 text-xs">Delete</button>
                </form>
              </div>
            </article>
            {% endfor %}
          </div>

          {% if products|length == 0 %}
          <div class="p-8 text-center text-sm text-gray-500 dark:text-gray-400">No products found.</div>
          {% endif %}

          <!-- Pagination -->
          <div class="flex items-center justify-between gap-3 px-4 py-3 border-t border-gray-200 dark:border-gray-800">
            <div class="text-xs text-gray-500" x-text="pageSummary"></div>
            <div id="pagination-container" class="flex flex-wrap items-center gap-1"></div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Small inline script to call updatePagination after Alpine loads (safe fallback) -->
  <script>
    document.addEventListener('alpine:init', () => {
      // nothing needed here - Alpine init will call x-init
      // But ensure pagination is built after assets load
      setTimeout(()=> {
        const root = document.querySelector('[x-data]');
        if (root && root.__x) {
          const cmp = root.__x.getUnobservedData ? root.__x.getUnobservedData() : null;
          // call updatePagination if available
          try {
            const alpineComp = document.querySelector('[x-data]').__x.$data || null;
            if (alpineComp && typeof alpineComp.updatePagination === 'function') alpineComp.updatePagination(true);
          } catch(e) { /* silent */ }
        }
      }, 250);
    });
  </script>

</body>
</html>
